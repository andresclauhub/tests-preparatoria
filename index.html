<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Unidad 1 - Primer Semestre</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .student-info {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .student-info h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .student-info input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        .student-info input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .already-submitted {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .already-submitted h3 {
            color: #b45309;
            margin-bottom: 10px;
        }
        
        .already-submitted p {
            color: #92400e;
        }
        
        .materia-selector {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .materia-selector h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .materia-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .materia-btn {
            padding: 15px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s;
            color: #667eea;
        }
        
        .materia-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        
        .materia-btn.active {
            background: #667eea;
            color: white;
        }
        
        .materia-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #e5e7eb;
            border-color: #9ca3af;
            color: #6b7280;
        }
        
        .materia-btn.completed {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .materia-btn.completed::after {
            content: ' ‚úì';
        }
        
        .quiz-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: none;
        }
        
        .quiz-container.active {
            display: block;
        }
        
        .question {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            color: #1a1a2e;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option:hover {
            border-color: #667eea;
            background: #f0f3ff;
        }
        
        .option.selected {
            border-color: #667eea;
            background: #eef2ff;
        }
        
        .option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }
        
        .option.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }
        
        .option input {
            margin-right: 12px;
            accent-color: #667eea;
            width: 18px;
            height: 18px;
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: none;
        }
        
        .results.show {
            display: block;
        }
        
        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: 700;
        }
        
        .score-circle.excellent {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .score-circle.good {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        
        .score-circle.needs-work {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .score-circle.poor {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .score-number {
            font-size: 3rem;
        }
        
        .score-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .results h2 {
            color: #1a1a2e;
            margin-bottom: 10px;
        }
        
        .results p {
            color: #6b7280;
            margin-bottom: 20px;
        }
        
        .results-details {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .result-stat {
            text-align: center;
        }
        
        .result-stat .number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
        }
        
        .result-stat .label {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .saved-notice {
            margin-top: 20px;
            padding: 15px;
            background: #d1fae5;
            border: 2px solid #10b981;
            border-radius: 10px;
            color: #065f46;
        }
        
        .saved-notice.error {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
        
        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .question-counter {
            text-align: center;
            color: #6b7280;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        
        .loading-spinner {
            border: 3px solid #e5e7eb;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .materia-buttons {
                grid-template-columns: 1fr;
            }
            
            .results-details {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Test de Conocimientos - Unidad 1</h1>
            <p>Primer Semestre de Preparatoria</p>
            <p style="font-size: 0.8rem; margin-top: 10px; opacity: 0.8;">‚ö†Ô∏è Solo puedes contestar UNA vez por materia</p>
        </div>
        
        <div class="student-info">
            <h2>üë§ Informaci√≥n del Estudiante</h2>
            <input type="text" id="studentName" placeholder="Escribe tu nombre completo aqu√≠" onchange="checkStudentSubmissions()">
        </div>
        
        <div id="alreadySubmittedMessage" class="already-submitted" style="display: none;">
            <h3>‚ö†Ô∏è Ya has contestado este test</h3>
            <p id="submittedInfo"></p>
        </div>
        
        <div class="materia-selector" id="materiaSelector">
            <h2>üìñ Selecciona la materia a evaluar:</h2>
            <div class="materia-buttons" id="materiaButtons">
                <button class="materia-btn" data-materia="ciencias_sociales" onclick="selectMateria('ciencias_sociales')">üåç Ciencias Sociales I</button>
                <button class="materia-btn" data-materia="cultura_digital" onclick="selectMateria('cultura_digital')">üíª Cultura Digital I</button>
                <button class="materia-btn" data-materia="humanidades" onclick="selectMateria('humanidades')">üìö Humanidades I</button>
                <button class="materia-btn" data-materia="ingles" onclick="selectMateria('ingles')">üá¨üáß Ingl√©s I</button>
                <button class="materia-btn" data-materia="lengua" onclick="selectMateria('lengua')">‚úçÔ∏è Lengua y Comunicaci√≥n I</button>
                <button class="materia-btn" data-materia="materia_interacciones" onclick="selectMateria('materia_interacciones')">‚öóÔ∏è La Materia y sus Interacciones I</button>
                <button class="materia-btn" data-materia="matematicas" onclick="selectMateria('matematicas')">üî¢ Pensamiento Matem√°tico I</button>
            </div>
        </div>
        
        <div class="quiz-container" id="quizContainer">
            <div class="question-counter" id="questionCounter">Pregunta 1 de 10</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div id="questionsContainer"></div>
            <button class="submit-btn" id="submitBtn" onclick="submitQuiz()">üìä Enviar Respuestas</button>
        </div>
        
        <div class="results" id="resultsContainer">
            <div class="score-circle" id="scoreCircle">
                <div class="score-number" id="scoreNumber">0%</div>
                <div class="score-label">Calificaci√≥n</div>
            </div>
            <h2 id="resultTitle">¬°Resultado!</h2>
            <p id="resultMessage">Tu calificaci√≥n del examen</p>
            <div class="results-details">
                <div class="result-stat">
                    <div class="number" id="correctCount">0</div>
                    <div class="label">Correctas</div>
                </div>
                <div class="result-stat">
                    <div class="number" id="incorrectCount">0</div>
                    <div class="label">Incorrectas</div>
                </div>
                <div class="result-stat">
                    <div class="number" id="totalQuestions">10</div>
                    <div class="label">Total</div>
                </div>
            </div>
            <div id="savedNotice" class="saved-notice" style="display: none;">
                ‚úÖ Tus respuestas han sido guardadas correctamente.
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURACI√ìN - JSONBin.io
        // ==========================================
        // Para usar JSONBin.io:
        // 1. Ve a https://jsonbin.io y crea una cuenta gratuita
        // 2. Crea un nuevo bin con este contenido inicial: {"respuestas": []}
        // 3. Copia el BIN ID y ponlo aqu√≠ abajo
        // 4. Ve a API Keys y crea un Access Key con permisos de lectura y escritura
        // 5. Pon el Access Key aqu√≠ abajo
        
        const JSONBIN_BIN_ID = '6954604543b1c97be90f4014';
        const JSONBIN_API_KEY = '$2a$10$5o8PreuS42XMwEwVTSPErOBhkWBr6cdozvY.3w9orMlv9akPUhPj2';
        
        // ==========================================
        // BASE DE DATOS DE PREGUNTAS
        // ==========================================
        const quizzes = {
            ciencias_sociales: {
                title: "Ciencias Sociales I",
                questions: [
                    {
                        question: "¬øQu√© estudian las ciencias sociales?",
                        options: ["La naturaleza y los animales", "Al ser humano en sociedad", "Los n√∫meros y ecuaciones", "Los planetas y estrellas"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© disciplina estudia el pasado de la humanidad?",
                        options: ["Econom√≠a", "Geograf√≠a", "Historia", "Sociolog√≠a"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© elemento de la sociedad incluye valores, tradiciones y lengua compartidos?",
                        options: ["Territorio", "Poblaci√≥n", "Cultura", "Econom√≠a"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© instituci√≥n es responsable de la crianza y socializaci√≥n primaria?",
                        options: ["La escuela", "El gobierno", "La familia", "Los medios de comunicaci√≥n"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© m√©todo de investigaci√≥n consiste en preguntar a muchas personas?",
                        options: ["Observaci√≥n", "Encuesta", "Trabajo de campo", "An√°lisis de documentos"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°l es el orden correcto de los tipos de sociedad seg√∫n la historia?",
                        options: ["Industrial ‚Üí N√≥mada ‚Üí Agr√≠cola", "N√≥mada ‚Üí Agr√≠cola ‚Üí Industrial ‚Üí Postindustrial", "Agr√≠cola ‚Üí N√≥mada ‚Üí Industrial", "Postindustrial ‚Üí Industrial ‚Üí Agr√≠cola"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© disciplina estudia la producci√≥n y distribuci√≥n de bienes?",
                        options: ["Antropolog√≠a", "Econom√≠a", "Ciencia Pol√≠tica", "Psicolog√≠a Social"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© estudia la ciencia pol√≠tica?",
                        options: ["Las culturas humanas", "El poder y las instituciones pol√≠ticas", "El comportamiento del mercado", "Las estructuras de la sociedad"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© instituci√≥n se encarga de hacer el censo de poblaci√≥n en M√©xico?",
                        options: ["SEP", "INEGI", "SAT", "IMSS"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°ntas entidades federativas tiene M√©xico?",
                        options: ["28", "30", "32", "34"],
                        correct: 2
                    }
                ]
            },
            cultura_digital: {
                title: "Cultura Digital I",
                questions: [
                    {
                        question: "¬øQu√© es la inform√°tica?",
                        options: ["El estudio de los animales", "La ciencia del procesamiento autom√°tico de informaci√≥n", "El estudio de la historia", "La ciencia de los minerales"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°l es la unidad m√≠nima de informaci√≥n en una computadora?",
                        options: ["Byte", "Kilobyte", "Bit", "Megabyte"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© componente es el 'cerebro' de la computadora?",
                        options: ["RAM", "Disco duro", "CPU", "Tarjeta de video"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© tipo de dispositivo es el teclado?",
                        options: ["De salida", "De entrada", "De almacenamiento", "De procesamiento"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© indica el protocolo HTTPS?",
                        options: ["Una p√°gina lenta", "Una conexi√≥n segura", "Un error de red", "Una p√°gina antigua"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°ntos bytes tiene un kilobyte?",
                        options: ["100", "1000", "1024", "512"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© es un sistema operativo?",
                        options: ["Un tipo de virus", "Software que administra la computadora", "Un navegador web", "Un documento de texto"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°l es un ejemplo de software de aplicaci√≥n?",
                        options: ["Windows", "Controlador de impresora", "Microsoft Word", "Linux"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© extensi√≥n tienen los archivos de imagen?",
                        options: [".docx", ".mp3", ".jpg", ".pdf"],
                        correct: 2
                    },
                    {
                        question: "¬øCu√°l es la diferencia entre RAM y disco duro?",
                        options: ["No hay diferencia", "RAM es permanente, disco duro es temporal", "RAM es temporal, disco duro es permanente", "Ambos son procesadores"],
                        correct: 2
                    }
                ]
            },
            humanidades: {
                title: "Humanidades I",
                questions: [
                    {
                        question: "¬øQu√© estudian las humanidades?",
                        options: ["Los n√∫meros", "La condici√≥n humana", "Los animales", "Las plantas"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© disciplina human√≠stica estudia los textos escritos como novelas y poes√≠a?",
                        options: ["Historia", "Filosof√≠a", "Literatura", "√âtica"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© es la cultura?",
                        options: ["Solo el arte", "Conjunto de conocimientos, creencias y tradiciones compartidas", "Solo el idioma", "Solo la religi√≥n"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© estudia la √©tica?",
                        options: ["La belleza", "El bien y el mal", "El pasado", "El lenguaje"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°ntas lenguas ind√≠genas tiene M√©xico aproximadamente?",
                        options: ["20", "40", "68", "100"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© tipo de cultura incluye tradiciones y creencias?",
                        options: ["Material", "Inmaterial", "F√≠sica", "Natural"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© valor se refiere a decir la verdad?",
                        options: ["Respeto", "Honestidad", "Solidaridad", "Tolerancia"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© disciplina busca respuestas a las grandes preguntas de la existencia?",
                        options: ["Historia", "Arte", "Filosof√≠a", "Ling√º√≠stica"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© es la identidad?",
                        options: ["Un documento oficial", "Lo que nos hace √∫nicos como individuos o grupos", "Un tipo de m√∫sica", "Una tradici√≥n"],
                        correct: 1
                    },
                    {
                        question: "Las humanidades desarrollan pensamiento cr√≠tico, comunicaci√≥n y:",
                        options: ["C√°lculo", "Empat√≠a", "Programaci√≥n", "Agricultura"],
                        correct: 1
                    }
                ]
            },
            ingles: {
                title: "Ingl√©s I",
                questions: [
                    {
                        question: "¬øC√≥mo se dice 'Buenos d√≠as' en ingl√©s?",
                        options: ["Good night", "Good afternoon", "Good morning", "Good evening"],
                        correct: 2
                    },
                    {
                        question: "¬øCu√°l es la respuesta correcta a 'How are you?'",
                        options: ["My name is...", "I'm fine, thank you", "I'm from Mexico", "Nice to meet you"],
                        correct: 1
                    },
                    {
                        question: "¬øC√≥mo se dice 'Mucho gusto' en ingl√©s?",
                        options: ["Thank you", "You're welcome", "Nice to meet you", "Goodbye"],
                        correct: 2
                    },
                    {
                        question: "¬øCu√°l es el pronombre para 'Ella' en ingl√©s?",
                        options: ["He", "She", "It", "They"],
                        correct: 1
                    },
                    {
                        question: "¬øC√≥mo se dice 'De nada' en ingl√©s?",
                        options: ["Please", "Thank you", "You're welcome", "Excuse me"],
                        correct: 2
                    },
                    {
                        question: "¬øCu√°l saludo es informal?",
                        options: ["Good morning", "Good afternoon", "Hi", "How do you do?"],
                        correct: 2
                    },
                    {
                        question: "'I'm from Mexico' significa:",
                        options: ["Vivo en M√©xico", "Soy de M√©xico", "Me gusta M√©xico", "Estudio en M√©xico"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°l es la contracci√≥n de 'I am'?",
                        options: ["I've", "I'll", "I'm", "I'd"],
                        correct: 2
                    },
                    {
                        question: "¬øC√≥mo se pregunta '¬øCu√°ntos a√±os tienes?' en ingl√©s?",
                        options: ["What's your name?", "Where are you from?", "How old are you?", "What do you do?"],
                        correct: 2
                    },
                    {
                        question: "'See you later' significa:",
                        options: ["Adi√≥s", "Buenas noches", "Nos vemos luego", "Mucho gusto"],
                        correct: 2
                    }
                ]
            },
            lengua: {
                title: "Lengua y Comunicaci√≥n I",
                questions: [
                    {
                        question: "¬øQui√©n env√≠a el mensaje en el proceso de comunicaci√≥n?",
                        options: ["El receptor", "El emisor", "El canal", "El c√≥digo"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© funci√≥n del lenguaje se usa para informar objetivamente?",
                        options: ["Emotiva", "Apelativa", "Referencial", "Po√©tica"],
                        correct: 2
                    },
                    {
                        question: "¬øCu√°l es la diferencia entre lengua y habla?",
                        options: ["No hay diferencia", "Lengua es el sistema, habla es el uso individual", "Habla es el sistema, lengua es el uso individual", "Ambos son lo mismo que lenguaje"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© tipo de comunicaci√≥n incluye gestos y expresiones faciales?",
                        options: ["Verbal", "Oral", "No verbal", "Escrita"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© funci√≥n del lenguaje busca influir en el receptor?",
                        options: ["Referencial", "Emotiva", "Apelativa", "F√°tica"],
                        correct: 2
                    },
                    {
                        question: "El ruido es un ejemplo de barrera de comunicaci√≥n:",
                        options: ["Sem√°ntica", "Psicol√≥gica", "F√≠sica", "Cultural"],
                        correct: 2
                    },
                    {
                        question: "¬øQu√© estilo de comunicaci√≥n expresa opiniones respetando a los dem√°s?",
                        options: ["Pasivo", "Agresivo", "Asertivo", "Evasivo"],
                        correct: 2
                    },
                    {
                        question: "Las variantes diat√≥picas se refieren a diferencias:",
                        options: ["Por edad", "Por regi√≥n geogr√°fica", "Por situaci√≥n social", "Por nivel educativo"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© tipo de comunicaci√≥n no verbal estudia el uso del espacio?",
                        options: ["Kin√©sica", "Prox√©mica", "Paraling√º√≠stica", "Ic√≥nica"],
                        correct: 1
                    },
                    {
                        question: "La retroalimentaci√≥n es:",
                        options: ["El mensaje original", "La respuesta del receptor al emisor", "El canal de comunicaci√≥n", "El c√≥digo utilizado"],
                        correct: 1
                    }
                ]
            },
            materia_interacciones: {
                title: "La Materia y sus Interacciones I",
                questions: [
                    {
                        question: "¬øQu√© es la materia?",
                        options: ["Solo los s√≥lidos", "Todo lo que tiene masa y ocupa espacio", "Solo los l√≠quidos", "La luz y el sonido"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°l es una propiedad espec√≠fica de la materia?",
                        options: ["Masa", "Volumen", "Densidad", "Peso"],
                        correct: 2
                    },
                    {
                        question: "La f√≥rmula de la densidad es:",
                        options: ["D = V/m", "D = m √ó V", "D = m/V", "D = m + V"],
                        correct: 2
                    },
                    {
                        question: "¬øA qu√© temperatura hierve el agua al nivel del mar?",
                        options: ["0¬∞C", "50¬∞C", "100¬∞C", "200¬∞C"],
                        correct: 2
                    },
                    {
                        question: "Un objeto flota cuando su densidad es:",
                        options: ["Mayor que la del l√≠quido", "Igual que la del l√≠quido", "Menor que la del l√≠quido", "No importa la densidad"],
                        correct: 2
                    },
                    {
                        question: "¬øCu√°l es la unidad del peso?",
                        options: ["Kilogramo", "Newton", "Gramo", "Metro"],
                        correct: 1
                    },
                    {
                        question: "El punto de fusi√≥n es cuando un s√≥lido pasa a:",
                        options: ["Gas", "L√≠quido", "Plasma", "S√≥lido m√°s duro"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© sustancia tiene una densidad de 1 g/cm¬≥?",
                        options: ["Aceite", "Hierro", "Agua", "Oro"],
                        correct: 2
                    },
                    {
                        question: "La masa de un objeto en la Luna:",
                        options: ["Cambia", "Es cero", "Es la misma que en la Tierra", "Se duplica"],
                        correct: 2
                    },
                    {
                        question: "¬øPor qu√© flota el hielo en el agua?",
                        options: ["Porque es m√°s denso", "Porque es menos denso", "Porque es m√°s pesado", "No flota"],
                        correct: 1
                    }
                ]
            },
            matematicas: {
                title: "Pensamiento Matem√°tico I",
                questions: [
                    {
                        question: "¬øCu√°l es el resultado de (-5) + (-3)?",
                        options: ["-8", "8", "-2", "2"],
                        correct: 0
                    },
                    {
                        question: "¬øCu√°l es el resultado de (-4) √ó (-2)?",
                        options: ["-8", "8", "-6", "6"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°nto es 2¬≥?",
                        options: ["6", "8", "5", "9"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°l es la ra√≠z cuadrada de 25?",
                        options: ["4", "5", "6", "7"],
                        correct: 1
                    },
                    {
                        question: "¬øQu√© tipo de n√∫mero es ‚àö2?",
                        options: ["Natural", "Entero", "Racional", "Irracional"],
                        correct: 3
                    },
                    {
                        question: "¬øCu√°nto es 1/2 + 1/3?",
                        options: ["2/5", "5/6", "1/5", "2/6"],
                        correct: 1
                    },
                    {
                        question: "Seg√∫n la jerarqu√≠a de operaciones, ¬øqu√© se resuelve primero en 3 + 4 √ó 2?",
                        options: ["La suma", "La multiplicaci√≥n", "Da igual", "Ninguna"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°l es el resultado de 5‚Å∞?",
                        options: ["0", "1", "5", "Indefinido"],
                        correct: 1
                    },
                    {
                        question: "¬øCu√°nto es 3/4 √ó 2/3?",
                        options: ["6/12", "1/2", "5/7", "6/7"],
                        correct: 1
                    },
                    {
                        question: "El s√≠mbolo ‚Ñ§ representa los n√∫meros:",
                        options: ["Naturales", "Enteros", "Racionales", "Irracionales"],
                        correct: 1
                    }
                ]
            }
        };
        
        let currentMateria = null;
        let answers = {};
        let studentSubmissions = {}; // Almacena qu√© materias ya contest√≥ cada estudiante
        
        // Verificar si JSONBin est√° configurado
        function isJSONBinConfigured() {
            return JSONBIN_BIN_ID !== 'TU_BIN_ID_AQUI' && JSONBIN_API_KEY !== 'TU_API_KEY_AQUI';
        }
        
        // Cargar respuestas existentes del servidor
        async function loadExistingResponses() {
            if (!isJSONBinConfigured()) {
                console.log('JSONBin no configurado. Las respuestas se guardar√°n localmente.');
                loadLocalResponses();
                return;
            }
            
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
                    headers: {
                        'X-Access-Key': JSONBIN_API_KEY
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const respuestas = data.record.respuestas || [];
                    
                    // Crear √≠ndice de submissions por estudiante
                    respuestas.forEach(r => {
                        const nombreNorm = r.nombre.toLowerCase().trim();
                        if (!studentSubmissions[nombreNorm]) {
                            studentSubmissions[nombreNorm] = {};
                        }
                        studentSubmissions[nombreNorm][r.materia] = r;
                    });
                }
            } catch (error) {
                console.error('Error cargando respuestas:', error);
                loadLocalResponses();
            }
        }
        
        // Cargar respuestas desde localStorage (fallback)
        function loadLocalResponses() {
            const saved = localStorage.getItem('test_submissions');
            if (saved) {
                studentSubmissions = JSON.parse(saved);
            }
        }
        
        // Guardar respuesta en el servidor
        async function saveResponse(responseData) {
            // Siempre guardar localmente primero
            const nombreNorm = responseData.nombre.toLowerCase().trim();
            if (!studentSubmissions[nombreNorm]) {
                studentSubmissions[nombreNorm] = {};
            }
            studentSubmissions[nombreNorm][responseData.materia] = responseData;
            localStorage.setItem('test_submissions', JSON.stringify(studentSubmissions));
            
            if (!isJSONBinConfigured()) {
                return { success: true, local: true };
            }
            
            try {
                // Primero obtener datos existentes
                const getResponse = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
                    headers: {
                        'X-Access-Key': JSONBIN_API_KEY
                    }
                });
                
                let existingData = { respuestas: [] };
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    existingData = data.record;
                }
                
                // Agregar nueva respuesta
                existingData.respuestas.push(responseData);
                
                // Guardar de vuelta
                const putResponse = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Access-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(existingData)
                });
                
                return { success: putResponse.ok };
            } catch (error) {
                console.error('Error guardando respuesta:', error);
                return { success: false, error: error.message };
            }
        }
        
        // Verificar si el estudiante ya contest√≥ alguna materia
        function checkStudentSubmissions() {
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName) return;
            
            const nombreNorm = studentName.toLowerCase().trim();
            const submissions = studentSubmissions[nombreNorm] || {};
            
            // Actualizar botones de materias
            document.querySelectorAll('.materia-btn').forEach(btn => {
                const materia = btn.dataset.materia;
                if (submissions[materia]) {
                    btn.disabled = true;
                    btn.classList.add('completed');
                } else {
                    btn.disabled = false;
                    btn.classList.remove('completed');
                }
            });
        }
        
        function selectMateria(materia) {
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                alert('Por favor, escribe tu nombre antes de comenzar.');
                return;
            }
            
            // Verificar si ya contest√≥ esta materia
            const nombreNorm = studentName.toLowerCase().trim();
            if (studentSubmissions[nombreNorm] && studentSubmissions[nombreNorm][materia]) {
                const submission = studentSubmissions[nombreNorm][materia];
                document.getElementById('alreadySubmittedMessage').style.display = 'block';
                document.getElementById('submittedInfo').textContent = 
                    `Ya contestaste ${quizzes[materia].title} el ${submission.fecha}. Tu calificaci√≥n fue: ${submission.calificacion}%`;
                return;
            }
            
            document.getElementById('alreadySubmittedMessage').style.display = 'none';
            
            currentMateria = materia;
            answers = {};
            
            // Actualizar botones
            document.querySelectorAll('.materia-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Mostrar quiz
            const quizContainer = document.getElementById('quizContainer');
            quizContainer.classList.add('active');
            document.getElementById('resultsContainer').classList.remove('show');
            document.getElementById('savedNotice').style.display = 'none';
            
            // Generar preguntas
            generateQuestions(quizzes[materia].questions);
            updateProgress();
        }
        
        function generateQuestions(questions) {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.id = `question-${index}`;
                
                let optionsHTML = '';
                q.options.forEach((opt, optIndex) => {
                    optionsHTML += `
                        <label class="option" onclick="selectOption(${index}, ${optIndex})">
                            <input type="radio" name="q${index}" value="${optIndex}">
                            ${opt}
                        </label>
                    `;
                });
                
                questionDiv.innerHTML = `
                    <div class="question-text">${index + 1}. ${q.question}</div>
                    <div class="options">
                        ${optionsHTML}
                    </div>
                `;
                
                container.appendChild(questionDiv);
            });
            
            document.getElementById('totalQuestions').textContent = questions.length;
            document.getElementById('submitBtn').disabled = false;
        }
        
        function selectOption(questionIndex, optionIndex) {
            answers[questionIndex] = optionIndex;
            
            // Marcar como seleccionada
            const question = document.getElementById(`question-${questionIndex}`);
            question.querySelectorAll('.option').forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                }
            });
            
            updateProgress();
        }
        
        function updateProgress() {
            const questions = quizzes[currentMateria].questions;
            const answered = Object.keys(answers).length;
            const progress = (answered / questions.length) * 100;
            
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('questionCounter').textContent = 
                `Respondidas: ${answered} de ${questions.length}`;
        }
        
        async function submitQuiz() {
            const questions = quizzes[currentMateria].questions;
            const answeredCount = Object.keys(answers).length;
            
            if (answeredCount < questions.length) {
                if (!confirm(`Solo has respondido ${answeredCount} de ${questions.length} preguntas. ¬øDeseas continuar? NO podr√°s volver a intentarlo.`)) {
                    return;
                }
            }
            
            let correct = 0;
            const respuestasDetalle = [];
            
            questions.forEach((q, index) => {
                const question = document.getElementById(`question-${index}`);
                const options = question.querySelectorAll('.option');
                
                options.forEach((opt, optIdx) => {
                    if (optIdx === q.correct) {
                        opt.classList.add('correct');
                    } else if (answers[index] === optIdx) {
                        opt.classList.add('incorrect');
                    }
                });
                
                const isCorrect = answers[index] === q.correct;
                if (isCorrect) {
                    correct++;
                }
                
                respuestasDetalle.push({
                    pregunta: q.question,
                    respuestaEstudiante: answers[index] !== undefined ? q.options[answers[index]] : 'Sin respuesta',
                    respuestaCorrecta: q.options[q.correct],
                    correcta: isCorrect
                });
            });
            
            const percentage = Math.round((correct / questions.length) * 100);
            
            // Mostrar resultados
            document.getElementById('scoreNumber').textContent = `${percentage}%`;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = questions.length - correct;
            
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.className = 'score-circle';
            
            const resultTitle = document.getElementById('resultTitle');
            const resultMessage = document.getElementById('resultMessage');
            
            if (percentage >= 90) {
                scoreCircle.classList.add('excellent');
                resultTitle.textContent = 'üéâ ¬°Excelente!';
                resultMessage.textContent = '¬°Felicidades! Dominas muy bien este tema.';
            } else if (percentage >= 70) {
                scoreCircle.classList.add('good');
                resultTitle.textContent = 'üëç ¬°Buen trabajo!';
                resultMessage.textContent = 'Tienes un buen nivel, pero puedes mejorar.';
            } else if (percentage >= 50) {
                scoreCircle.classList.add('needs-work');
                resultTitle.textContent = 'üìö Necesitas repasar';
                resultMessage.textContent = 'Te recomendamos estudiar m√°s los apuntes.';
            } else {
                scoreCircle.classList.add('poor');
                resultTitle.textContent = 'üí™ ¬°√Ånimo!';
                resultMessage.textContent = 'Necesitas estudiar m√°s. ¬°T√∫ puedes!';
            }
            
            document.getElementById('resultsContainer').classList.add('show');
            document.getElementById('submitBtn').disabled = true;
            
            // Preparar datos para guardar
            const studentName = document.getElementById('studentName').value.trim();
            const now = new Date();
            const responseData = {
                nombre: studentName,
                materia: currentMateria,
                materiaTitle: quizzes[currentMateria].title,
                calificacion: percentage,
                correctas: correct,
                totalPreguntas: questions.length,
                fecha: now.toLocaleDateString('es-MX'),
                hora: now.toLocaleTimeString('es-MX'),
                timestamp: now.toISOString(),
                respuestas: respuestasDetalle
            };
            
            // Guardar respuesta
            const savedNotice = document.getElementById('savedNotice');
            const saveResult = await saveResponse(responseData);
            
            if (saveResult.success) {
                savedNotice.className = 'saved-notice';
                savedNotice.innerHTML = saveResult.local 
                    ? '‚úÖ Tus respuestas han sido guardadas localmente.'
                    : '‚úÖ Tus respuestas han sido guardadas correctamente.';
            } else {
                savedNotice.className = 'saved-notice error';
                savedNotice.innerHTML = '‚ö†Ô∏è Hubo un problema al guardar. Tus respuestas se guardaron localmente.';
            }
            savedNotice.style.display = 'block';
            
            // Actualizar botones de materias
            checkStudentSubmissions();
            
            // Scroll a resultados
            document.getElementById('resultsContainer').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Inicializar al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', async function() {
            await loadExistingResponses();
        });
    </script>
</body>
</html>

